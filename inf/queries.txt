SELECT *
FROM crosstab(
'SELECT criminal_id, attribute_type, attribute_value
FROM criminal_details
WHERE attribute_type=''EYE_COLOR'' or attribute_type=''HAIR_COLOR''
ORDER BY 1, 2'
) AS ct(rowid bigint, "EYE_COLOR" text, "HAIR_COLOR" text, "HEIGHT" text, "BIRTH_PLACE" text, "BIRTH_DATE" text, "LAST_RESIDENCE" text, "CITIZENSHIP" text);



SELECT criminal_id, attribute_type, attribute_value
FROM criminal_details
WHERE attribute_type='EYE_COLOR' or attribute_type='HAIR_COLOR'
ORDER BY 1, 2;




SELECT *
FROM crosstab(
'SELECT criminal_id, attribute_type, attribute_value
FROM criminal_details
WHERE attribute_type=''EYE_COLOR'' or attribute_type=''HAIR_COLOR''
ORDER BY 1, 2'
) AS ct(rowid bigint, "EYE_COLOR" text, "HAIR_COLOR" text);


ANSWER ------------------------

SELECT *
FROM crosstab(
'SELECT criminal_id, attribute_type, attribute_value
FROM criminal_details
WHERE attribute_type=''EYE_COLOR'' or attribute_type=''HAIR_COLOR''
ORDER BY 1, 2'
) AS ct(rowid bigint, "EYE_COLOR" varchar, "HAIR_COLOR" varchar);

SELECT *
FROM crosstab(
'SELECT criminal_id, attribute_type, attribute_value
FROM criminal_details
WHERE attribute_type=''EYE_COLOR'' or attribute_type=''HAIR_COLOR''
ORDER BY 1, 2'
) AS ct(rowid bigint, "EYE_COLOR" varchar, "HAIR_COLOR" varchar, "HEIGHT" varchar, "BIRTH_PLACE" varchar, "BIRTH_DATE" varchar, "LAST_RESIDENCE" varchar, "CITIZENSHIP" varchar);




SELECT
ct.rowid as criminal_id,
ct."EYE_COLOR",
ct."HAIR_COLOR",
ct."HEIGHT",
ct."BIRTH_PLACE",
TO_TIMESTAMP(ct."BIRTH_DATE", 'YYYY-MM-DD') as "BIRTH_DATE" ,
ct."LAST_RESIDENCE",
ct."CITIZENSHIP"
FROM crosstab(
'SELECT criminal_id, attribute_type, attribute_value
FROM criminal_details
ORDER BY 1, 2'
, $$VALUES ('EYE_COLOR'::varchar), ('HAIR_COLOR'), ('HEIGHT'), ('BIRTH_PLACE'), ('BIRTH_DATE'), ('LAST_RESIDENCE'), ('CITIZENSHIP') $$
) AS ct(rowid bigint, "EYE_COLOR" varchar, "HAIR_COLOR" varchar, "HEIGHT" varchar, "BIRTH_PLACE" varchar, "BIRTH_DATE" varchar, "LAST_RESIDENCE" varchar, "CITIZENSHIP" varchar);





SELECT
ct.rowid as criminal_id,
ct."EYE_COLOR",
ct."HAIR_COLOR",
ct."HEIGHT",
ct."BIRTH_PLACE",
TO_TIMESTAMP(ct."BIRTH_DATE", 'YYYY-MM-DD') as "BIRTH_DATE" ,
ct."LAST_RESIDENCE",
ct."CITIZENSHIP"
FROM crosstab(
'SELECT criminal_id, attribute_type, attribute_value
FROM criminal_details
ORDER BY 1, 2'
, $$VALUES ('EYE_COLOR'::varchar), ('HAIR_COLOR'), ('HEIGHT'), ('BIRTH_PLACE'), ('BIRTH_DATE'), ('LAST_RESIDENCE'), ('CITIZENSHIP') $$
) AS ct(rowid bigint, "EYE_COLOR" varchar, "HAIR_COLOR" varchar, "HEIGHT" varchar, "BIRTH_PLACE" varchar, "BIRTH_DATE" varchar, "LAST_RESIDENCE" varchar, "CITIZENSHIP" varchar)
WHERE "EYE_COLOR" = 'green';


SELECT
    ct.rowid AS criminal_id,
    ct.EYE_COLOR,
    ct.HAIR_COLOR,
    ct.HEIGHT,
    ct.BIRTH_PLACE,
    TO_TIMESTAMP(ct.BIRTH_DATE, 'YYYY-MM-DD') AS BIRTH_DATE,
    ct.LAST_RESIDENCE,
    ct.CITIZENSHIP
FROM
    crosstab(
        'SELECT criminal_id, attribute_type, attribute_value FROM criminal_details ORDER BY 1, 2',
        $$VALUES ('EYE_COLOR'), ('HAIR_COLOR'), ('HEIGHT'), ('BIRTH_PLACE'), ('BIRTH_DATE'), ('LAST_RESIDENCE'), ('CITIZENSHIP')$$
    ) AS ct(
        rowid bigint,
        EYE_COLOR varchar,
        HAIR_COLOR varchar,
        HEIGHT varchar,
        BIRTH_PLACE varchar,
        BIRTH_DATE varchar,
        LAST_RESIDENCE varchar,
        CITIZENSHIP varchar
    )
WHERE
    ('green' IS NULL OR ct.EYE_COLOR = 'green')
    AND (null::varchar IS NULL OR ct.HAIR_COLOR = null::varchar)
    AND (null::varchar IS NULL OR ct.HEIGHT = null::varchar)
    AND (null::varchar IS NULL OR ct.BIRTH_PLACE = null::varchar)
    AND (null::varchar IS NULL OR ct.BIRTH_DATE = null::varchar)
    AND (null::varchar IS NULL OR ct.LAST_RESIDENCE = null::varchar)
    AND (null::varchar IS NULL OR ct.CITIZENSHIP = null::varchar);




------------------------------------------------------HQL----------------------------------------------------------------------
@NamedNativeQuery(
name = "Criminal.findCriminalsByAttribute",
query = "SELECT ct.rowid as id, " +
"ct.EYE_COLOR, " +
"ct.HAIR_COLOR, " +
"ct.HEIGHT, " +
"ct.BIRTH_PLACE, " +
"TO_TIMESTAMP(ct.BIRTH_DATE, 'YYYY-MM-DD') as BIRTH_DATE, " +
"ct.LAST_RESIDENCE, " +
"ct.CITIZENSHIP " +
"FROM crosstab( " +
"'SELECT criminal_id, attribute_type, attribute_value " +
"FROM criminal_details " +
"WHERE (:attributeType IS NULL OR attribute_type = :attributeType) " +
"AND (:attributeValue IS NULL OR attribute_value = :attributeValue) " +
"ORDER BY 1, 2', " +
"$$VALUES ('EYE_COLOR'::varchar), " +
"('HAIR_COLOR'), " +
"('HEIGHT'), " +
"('BIRTH_PLACE'), " +
"('BIRTH_DATE'), " +
"('LAST_RESIDENCE'), " +
"('CITIZENSHIP') $$) " +
"AS ct(rowid bigint, EYE_COLOR varchar, HAIR_COLOR varchar, HEIGHT varchar, BIRTH_PLACE varchar, BIRTH_DATE varchar, LAST_RESIDENCE varchar, CITIZENSHIP varchar)",
resultSetMapping = "CriminalDTOMapping"
)
@SqlResultSetMapping(
name = "CriminalDTOMapping",
classes = @ConstructorResult(
targetClass = CriminalDTO.class,
columns = {
@ColumnResult(name = "id", type = Long.class),
@ColumnResult(name = "EYE_COLOR", type = String.class),
@ColumnResult(name = "HAIR_COLOR", type = String.class),
@ColumnResult(name = "HEIGHT", type = String.class),
@ColumnResult(name = "BIRTH_PLACE", type = String.class),
@ColumnResult(name = "BIRTH_DATE", type = Date.class),
@ColumnResult(name = "LAST_RESIDENCE", type = String.class),
@ColumnResult(name = "CITIZENSHIP", type = String.class)
}
)
)




JpaRepository Method

@Query(value = "SELECT ct.rowid as criminal_id, " +
"ct.EYE_COLOR, " +
"ct.HAIR_COLOR, " +
"ct.HEIGHT, " +
"ct.BIRTH_PLACE, " +
"TO_TIMESTAMP(ct.BIRTH_DATE, 'YYYY-MM-DD') as BIRTH_DATE, " +
"ct.LAST_RESIDENCE, " +
"ct.CITIZENSHIP " +
"FROM crosstab( " +
"'SELECT criminal_id, attribute_type, attribute_value " +
"FROM criminal_details " +
"ORDER BY 1, 2', " +
"$$VALUES ('EYE_COLOR'::varchar), " +
"('HAIR_COLOR'), " +
"('HEIGHT'), " +
"('BIRTH_PLACE'), " +
"('BIRTH_DATE'), " +
"('LAST_RESIDENCE'), " +
"('CITIZENSHIP') $$) " +
"AS ct(rowid bigint, EYE_COLOR varchar, HAIR_COLOR varchar, HEIGHT varchar, BIRTH_PLACE varchar, BIRTH_DATE varchar, LAST_RESIDENCE varchar, CITIZENSHIP varchar) " +
"WHERE (:eyeColor IS NULL OR ct.EYE_COLOR = :eyeColor) " +
"AND (:hairColor IS NULL OR ct.HAIR_COLOR = :hairColor) " +
"AND (:height IS NULL OR ct.HEIGHT = :height) " +
"AND (:birthPlace IS NULL OR ct.BIRTH_PLACE = :birthPlace) " +
"AND (:birthDate IS NULL OR TO_TIMESTAMP(ct.BIRTH_DATE, 'YYYY-MM-DD') = TO_TIMESTAMP(:birthDate, 'YYYY-MM-DD')) " +
"AND (:lastResidence IS NULL OR ct.LAST_RESIDENCE = :lastResidence) " +
"AND (:citizenship IS NULL OR ct.CITIZENSHIP = :citizenship)",
nativeQuery = true)
List<CriminalDTO> findCriminalsByAttributes(String eyeColor, String hairColor, String height, String birthPlace, String birthDate, String lastResidence, String citizenship);


@Query(value = "SELECT ct.rowid as criminal_id, " +
            "ct.EYE_COLOR, " +
            "ct.HAIR_COLOR, " +
            "ct.HEIGHT, " +
            "ct.BIRTH_PLACE, " +
            "TO_TIMESTAMP(ct.BIRTH_DATE, 'YYYY-MM-DD') as BIRTH_DATE, " +
            "ct.LAST_RESIDENCE, " +
            "ct.CITIZENSHIP " +
            "FROM crosstab( " +
            "'SELECT criminal_id, attribute_type, attribute_value " +
            "FROM criminal_details " +
            "ORDER BY 1, 2', " +
            "$$VALUES (cast('EYE_COLOR' as varchar)), " +
            "('HAIR_COLOR'), " +
            "('HEIGHT'), " +
            "('BIRTH_PLACE'), " +
            "('BIRTH_DATE'), " +
            "('LAST_RESIDENCE'), " +
            "('CITIZENSHIP') $$) " +
            "AS ct(rowid bigint, EYE_COLOR varchar, HAIR_COLOR varchar, HEIGHT varchar, BIRTH_PLACE varchar, BIRTH_DATE varchar, LAST_RESIDENCE varchar, CITIZENSHIP varchar) " +
            "WHERE (:eyeColor IS NULL OR ct.EYE_COLOR = :eyeColor) " +
            "AND (:hairColor IS NULL OR ct.HAIR_COLOR = :hairColor) " +
            "AND (:height IS NULL OR ct.HEIGHT = :height) " +
            "AND (:birthPlace IS NULL OR ct.BIRTH_PLACE = :birthPlace) " +
            "AND (:birthDate IS NULL OR TO_TIMESTAMP(ct.BIRTH_DATE, 'YYYY-MM-DD') = TO_TIMESTAMP(:birthDate, 'YYYY-MM-DD')) " +
            "AND (:lastResidence IS NULL OR ct.LAST_RESIDENCE = :lastResidence) " +
            "AND (:citizenship IS NULL OR ct.CITIZENSHIP = :citizenship)",
            nativeQuery = true)
    List<CriminalDetailsDTO> findCriminalsByAttributes(
            String eyeColor,
            String hairColor,
            String height,
            String birthPlace,
            String birthDate,
            String lastResidence,
            String citizenship
    );


















SELECT
    ct.rowid AS criminal_id,
    ct.EYE_COLOR,
    ct.HAIR_COLOR,
    ct.HEIGHT,
    ct.BIRTH_PLACE,
    TO_TIMESTAMP(ct.BIRTH_DATE, 'YYYY-MM-DD') AS BIRTH_DATE,
    ct.LAST_RESIDENCE,
    ct.CITIZENSHIP
FROM
    crosstab(
            'SELECT criminal_id, attribute_type, attribute_value FROM criminal_details ORDER BY 1, 2',
            $$VALUES ('EYE_COLOR'), ('HAIR_COLOR'), ('HEIGHT'), ('BIRTH_PLACE'), ('BIRTH_DATE'), ('LAST_RESIDENCE'), ('CITIZENSHIP')$$
    ) AS ct(
            rowid bigint,
            EYE_COLOR varchar,
            HAIR_COLOR varchar,
            HEIGHT varchar,
            BIRTH_PLACE varchar,
            BIRTH_DATE varchar,
            LAST_RESIDENCE varchar,
            CITIZENSHIP varchar
        )
WHERE ('green' IS NULL OR ct.EYE_COLOR = 'green')
  AND (null::varchar IS NULL OR ct.HAIR_COLOR = null::varchar)
  AND (null::varchar IS NULL OR ct.HEIGHT = null::varchar)
  AND (null::varchar IS NULL OR ct.BIRTH_PLACE = null::varchar)
  AND (null::varchar IS NULL OR ct.BIRTH_DATE = null::varchar)
  AND (null::varchar IS NULL OR ct.LAST_RESIDENCE = null::varchar)
  AND (null::varchar IS NULL OR ct.CITIZENSHIP = null::varchar);









SELECT
    ct.rowid AS criminal_id,
    ct.EYE_COLOR,
    ct.HAIR_COLOR,
    ct.HEIGHT,
    ct.BIRTH_PLACE,
    TO_TIMESTAMP(ct.BIRTH_DATE, 'YYYY-MM-DD') AS BIRTH_DATE,
    ct.LAST_RESIDENCE,
    ct.CITIZENSHIP
FROM
    crosstab(
            'SELECT criminal_id, attribute_type, attribute_value FROM criminal_details ORDER BY 1, 2',
            $$VALUES ('EYE_COLOR'), ('HAIR_COLOR'), ('HEIGHT'), ('BIRTH_PLACE'), ('BIRTH_DATE'), ('LAST_RESIDENCE'), ('CITIZENSHIP')$$
    ) AS ct(
            rowid bigint,
            EYE_COLOR varchar,
            HAIR_COLOR varchar,
            HEIGHT varchar,
            BIRTH_PLACE varchar,
            BIRTH_DATE varchar,
            LAST_RESIDENCE varchar,
            CITIZENSHIP varchar
        )
WHERE
    (
        CAST(NULL AS varchar) IS NULL
            OR ct.EYE_COLOR = CAST(NULL AS varchar)
        )
  AND (
    CAST(NULL AS varchar) IS NULL
        OR ct.HAIR_COLOR = CAST(NULL AS varchar)
    )
  AND (
    CAST(NULL AS varchar) IS NULL
        OR ct.HEIGHT = CAST(NULL AS varchar)
    )
  AND (
    CAST(NULL AS varchar) IS NULL
        OR ct.BIRTH_PLACE = CAST(NULL AS varchar)
    )
  AND (
    CAST(NULL AS timestamp) IS NULL
        OR TO_TIMESTAMP(ct.BIRTH_DATE, 'YYYY-MM-DD') = TO_TIMESTAMP(CAST(NULL AS varchar), 'YYYY-MM-DD')
    )
  AND (
    CAST(NULL AS varchar) IS NULL
        OR ct.LAST_RESIDENCE = CAST(NULL AS varchar)
    )
  AND (
    CAST(NULL AS varchar) IS NULL
        OR ct.CITIZENSHIP = CAST(NULL AS varchar)
    );
